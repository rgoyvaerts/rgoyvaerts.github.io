'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var messages={No_Events:'No events to display'},createEmptyMessage=function(){return'<div class="list-message">'+messages.No_Events+'</div>'},createTitle=function(a){return'<div class="list-title">'+a+'</div>'},createItem=function(a,b,c,d,e){var f='';return f=1===e?'all-day':e?e+' days':a+' - '+b,'<div class="list-item"><a class="list-item-group" href="#"><div class="list-item-group-time">'+f+'</div><div class="list-item-group-summary">'+c+'</div></a><div class="list-item-description" aria-expanded="false">'+d+'</div>\n</div>'},Agenda=function(){function a(b,c,d){_classCallCheck(this,a),this.rootSelector=b,this.root=document.getElementById(this.rootSelector),this.apiKey=c,this.calendarId=d,this.currentYear=0,this.timeZone='Europe/Brussels',this.setup=this.setup.bind(this),this.render=this.render.bind(this),this.onClick=this.onClick.bind(this),this.fetch=this.fetch.bind(this),this.checkScroll=this.checkScroll.bind(this),this.setup()}return _createClass(a,[{key:'setup',value:function setup(){this.root.innerHTML='<div class="container"><div class="header"><div class="header-inner"><div><button aria-label="prev" id="prev"><span class="icon icon-prev"></span></button></div><div><h3></h3></div><div><button aria-label="next" id="next"><span class="icon icon-next"></span></button></div></div></div><div class="list"></div></div>',this.root.addEventListener('click',this.onClick),this.fetch('now')}},{key:'checkScroll',value:function checkScroll(){var b=document.querySelector('.header').offsetTop;window.pageYOffset>b?document.querySelector('.header-inner').classList.add('header-inner-sticky'):document.querySelector('.header-inner').classList.remove('header-inner-sticky')}},{key:'onClick',value:function onClick(b){if(b.target.closest('#next'))console.log('click next btn'),this.fetch(this.currentYear+1);else if(b.target.closest('#prev'))console.log('click prev btn'),this.fetch(this.currentYear-1);else if(b.target.closest('.list-item-group')){console.log('click list item'),b.preventDefault();var c=b.target.closest('.list-item'),d=c.querySelector('.list-item-description'),e='true'===d.getAttribute('aria-expanded');d.setAttribute('aria-expanded',!e);var f='true'===d.getAttribute('aria-expanded')?d.scrollHeight:0;d.style.maxHeight=f+'px'}}},{key:'render',value:function render(b){this.timeZone=b.timeZone,document.querySelector('.header h3').innerText=this.currentYear;var e=document.querySelector('.list'),f='',g='';if(0===b.items.length)return e.innerHTML=createEmptyMessage(),!0;for(var j=luxon.DateTime.fromObject({zone:this.timeZone}),k=0;k<b.items.length;k++){var l=b.items[k],c=luxon.DateTime.fromISO(l.end.dateTime||l.end.date),d=luxon.DateTime.fromISO(l.start.dateTime||l.start.date);if(!(c<j)){var m=d.toFormat('EEEE \'-\' d MMMM');g!==m&&(g=m,f+=createTitle(g));var n=c.diff(d,'days');f+=createItem(d.toFormat('T'),c.toFormat('T'),l.summary,l.description,parseInt(n.days))}}e.innerHTML=f}},{key:'fetch',value:function(b){function c(){return b.apply(this,arguments)}return c.toString=function(){return b.toString()},c}(function(b){var e=this;this.currentYear='now'===b?new Date().getUTCFullYear():b,console.log('currentYear',this.currentYear);var c=this.currentYear-1+'-12-31T23:00:00.000Z',d=this.currentYear+'-12-30T23:00:00.000Z';console.log(c,d),fetch('https://www.googleapis.com/calendar/v3/calendars/'+encodeURIComponent(this.calendarId)+'/events?key='+this.apiKey+'&orderBy=startTime&singleEvents=true&showDeleted=false&timeMax='+d+'&timeMin='+c+'&timeZone='+this.timeZone).then(function(f){return f.json()}).then(function(f){return e.render(f)}).catch(function(f){console.error(f)})})}]),a}();
